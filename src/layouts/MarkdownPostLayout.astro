---
import BaseLayout from './BaseLayout.astro';
const { frontmatter } = Astro.props;

// ã‚µã‚¤ãƒ‰ãƒãƒ¼ç”¨ã«å…¨æŠ•ç¨¿ã‚’å–å¾—
const allPosts = await Astro.glob('../pages/posts/*.md');

// å…¨ã‚¿ã‚°ã‚’åé›†ã—ã¦é‡è¤‡ã‚’å‰Šé™¤
const allTags = [...new Set(allPosts.flatMap(post => post.frontmatter.tags))];
---
<BaseLayout pageTitle={frontmatter.title}>
  <div class="flex flex-col md:flex-row md:gap-10">
    <main class="flex-grow min-w-0">
      <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mb-4">
        <span>ğŸ“… {frontmatter.pubDate.slice(0, 10)}</span>
        <span>âœï¸ {frontmatter.author}</span>
      </div>
      <img src={frontmatter.image.url} class="my-4 rounded-2xl shadow-md" width="300" alt={frontmatter.image.alt} />

      <div class="flex flex-wrap gap-2 my-4">
        {frontmatter.tags.map(tag => (
          <a href={`/tags/${tag}`} class="tag-badge">{tag}</a>
        ))}
      </div>
      <article class="prose dark:prose-invert max-w-none prose-headings:text-gray-900 dark:prose-headings:text-white prose-a:text-accent dark:prose-a:text-accent-light">
        <slot />
      </article>
    </main>

    <aside class="w-full md:w-72 shrink-0 mt-10 md:mt-0">
      <div class="glass-card p-6 sticky top-24">
        <h3 class="text-lg font-bold mb-4 gradient-text">æœ€è¿‘ã®æŠ•ç¨¿</h3>
        <ul class="space-y-3">
          {allPosts.sort((a, b) => new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf()).slice(0, 5).map(post => (
            <li>
              <a href={post.url} class="text-sm text-gray-600 dark:text-gray-300 hover:text-accent dark:hover:text-accent-light transition-colors">
                {post.frontmatter.title}
              </a>
            </li>
          ))}
        </ul>

        <h3 class="text-lg font-bold mt-8 mb-4 gradient-text">ã‚¿ã‚°ä¸€è¦§</h3>
        <div class="flex flex-wrap gap-2">
          {allTags.map(tag => (
            <a href={`/tags/${tag}`} class="tag-badge">{tag}</a>
          ))}
        </div>
      </div>
    </aside>
  </div>
</BaseLayout>
